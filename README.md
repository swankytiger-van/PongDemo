# PongDemo – 跨平台 2D 小游戏框架（面试作品）

&gt; 用 **C++20 + SFML + CMake + vcpkg + GitHub Actions** 构建的轻量级 2D 游戏框架；  
&gt; 目前仅渲染绿色圆球，后续迭代 **双人乒乓 → 网络对战 → AI bot → Tracy 性能剖析**。

---

## 1. 面试卖点
| 维度 | 已实现/可讲 |
|----|-------------|
| 语言标准 | C++20 强枚举、结构化绑定、std::optional 事件 |
| 资源管理 | RAII 封装 sf::Texture/sf::Sound，智能指针管理生命周期 |
| 构建系统 | CMake + vcpkg 跨平台依赖管理，Windows/Linux/macOS 三端 CI 自动发布绿色可执行包 |
| 工程素养 | -Wall -Wextra -Werror + Address/UB Sanitizer + 单元测试（预留 doctest 接口） |
| 网络预留 | 事件队列已抽象，后续直接塞 asio 协程 |
| 性能工具 | Tracy 标记点已留好，编译开关 `-DENABLE_TRACY=ON` 即可可视化帧率 |
| 热重载 | 关卡/配置 JSON 外置，运行时改文件立即生效（已留接口） |

---

## 2. 当前进度（Checkpoint）
- [x] 环境搭建：SFML + CMake + vcpkg + GitHub Actions ✔  
- [x] 最小可运行 Demo：窗口 + 事件循环 + 绿色圆球 ✔  
- [x] 三平台 CI 自动构建 & Release 可执行包 ✔  
- [x] 核心玩法：双人乒乓（球拍、球、碰撞、得分、重置）✔  
- [ ] 本地 AI 算法：minimax + alpha-beta 可调难度  
- [ ] 玩法设计创新：类弹球游戏，刷新各种道具与地形
- [ ] Tracy 性能剖析：帧时间、GPU 占用、内存波浪图  
- [ ] 网络联机：asio C++20 协程 + 客户端预测 + 服务器权威 
- [ ] 关卡编辑器（Qt/QML 或 ImGui）  

---

## 3. 技术栈
| 组件 | 选型 | 备注 |
|----|------|------|
| 语言 | C++20 | MSVC / GCC / Clang 均支持 |
| 图形 | SFML 3.0.2 | 2D 硬件加速，OpenGL 后端 |
| 包管理 | vcpkg | 一键拉取 SFML、asios、Tracy、doctest |
| 构建 | CMake ≥ 3.20 | 支持 Presets / Ninja / VS |
| CI/CD | GitHub Actions | 并行编译 Win/Linux/macOS，自动上传 Release |
| 网络 | asio standalone | 预留头文件路径，未实际编译 |
| 测试 | doctest（单头） | `src/test/` 已留文件夹 |
| 性能 | Tracy | 开关变量 `ENABLE_TRACY` |

---

## 4. 一键跑起来
### 4.1 下载即玩
1. 进入 [Release](https://github.com/swankytiger-van/PongDemo/releases) 页面  
2. 下载对应平台 zip → 解压 → 双击 `main.exe`（零依赖）

### 4.2 自己编译
```bash
# ① 克隆
git clone https://github.com/你的昵称/PongDemo.git
cd PongDemo

# ② 安装依赖（仅第一次）
vcpkg install sfml:x64-windows       # Win
# macOS: vcpkg install sfml:x64-osx
# Linux: vcpkg install sfml:x64-linux

# ③ 编译
cmake --preset=default               # 或 mkdir build && cd build && cmake .. -DCMAKE_TOOLCHAIN_FILE=[vcpkg]/scripts/buildsystems/vcpkg.cmake
cmake --build . --config Debug

# ④ 运行
build\bin\Debug\main.exe             # Win
# ./build/bin/Debug/main             # mac/linux

```
---

## 5.目录规范
```
PongDemo/
├─ src/                   # 源码
│  ├─ main.cpp           # 入口
│  ├─ Game.*             # 游戏状态机（待写）
│  ├─ Paddle.*           # 球拍（待写）
│  ├─ Ball.*             # 球（待写）
│  ├─ utils/             # 工具（数学常量、资源加载器）
│  └─ test/              # doctest 单元测试
├─ assets/                # 图片、音效、字体、关卡 json
├─ cmake/                 # 模块脚本（FindTracy.cmake 等）
├─ doc/                   # 截图、gif、架构图
├─ .github/workflows/     # CI 定义
├─ CMakeLists.txt
├─ vcpkg.json             # 依赖清单（CI 用）
├─ README.md              # 本文件
└─ LICENSE                # MIT（后续加）
```
---

## 6.后续开发路线图
| 迭代                   | 目标             | 关键技术点                              | 面试可聊                    |
| -------------------- | -------------- | ---------------------------------- | ----------------------- |
| 1. PongCore          | 球拍、球、碰撞、得分、重置  | AABB 碰撞、帧率无关速度、状态机                 | 碰撞优化、固定时间步              |
| 2. AI                | 可调节难度电脑        | Minimax + Alpha-Beta + 评估函数        | 算法复杂度、剪枝率               |
| 3. Online            | 局域网/公网 1v1     | asio C++20 协程、客户端预测、回滚             | lock-free 队列、UDP vs TCP |
| 4. Tracy             | 性能可视化          | Tracy 标记、GPU 计时、内存波浪               | 热点函数、优化前后对比             |
| 5. Editor            | 关卡/皮肤 JSON 热重载 | std::filesystem + std::chrono 文件监听 | 热重载实现原理                 |
| 6. Particles & ImGui | 粒子效果、调试面板      | 手写粒子系统、ImGui-SFML 后端               | GPU/CPU 粒子对比            |

---

## 7.踩过的坑速查（实时更新）
| 现象         | 解决                                                                   |
| ---------- | -------------------------------------------------------------------- |
| 找不到 SFML   | 确认 `vcpkg integrate install` 已执行，且 CMake 时传递 toolchain 文件            |
| 运行缺 dll    | 把 `vcpkg\installed\x64-windows\bin` 加入 PATH，或拷贝 dll 到 exe 同级         |
| CI 编译失败    | 检查 `vcpkg.json` 里 triplet 与 runner 系统是否一致（win-x64/linux-x64/osx-x64） |
| Tracy 无法连接 | 先运行 `Tracy.exe`  profiler，再开 `-DENABLE_TRACY=ON` 编译游戏                |
| 别再用你那个死鬼校园网了 |                                                                 |
| README显示问题，分级标题异常 |                   记得闭合代码块                            |
| CI报错128,vcpkg的问题 | 暂时弃用lukka写法，怀疑是缓存或者其他问题 |
| 改写法以后缺乏编译依赖|     依赖加装  |
| CI报错01cannot stat 'build/bin/Release/main': No such file or directory|  使用的Ninja生成器，不带.exe，改变打包路径为跨平台|
| CI依然报错01 | ubuntu生成规则不会主动生成release文件，更改package操作，寻找正确的可执行文件 |
| CI报错403 | 无法写出release，需要权限，更改设置 |
| 更换SFML版本以后，许多默认构造函数不存在| 自己写构造，并且通过延迟加载，防止构造失败的情况|
| 字体不适配，找不到font文件，自动搜索代码无法实现| 先固定font.ttf路径，手动载入对应位置|
| 按Space/Esc/R 都有反应，按W/S，↑/↓都无反馈| 重写球拍的状态更新功能 |
| 如果球拍侧面接触球，还是会穿模| 新增成员，不要只检测“当前位置是否重叠”，而要检测“上一帧到这一帧的球轨迹线段”是否与球拍相交。|
| 更改以后，判断如果穿模，就回滚到上一帧，下一帧如果速度仍然指向拍子内部，结果变成球一直黏在拍子上了| 增加一帧冷却时间 |
| 上传CI流程里ubuntu返回报错，说是识别不了fabs| 加上#include<cmath>就是了，真矫情，另外俩都不报错|
|游戏结束显示胜利以后，重新开始游戏时得分和倒计时不会重置| 手动重置 |
|添加倒计时后，球如果当前得分时在面板（上下来看的）中部，reset后球拍与球位置重合，会卡模型，下次开始时球不会回到屏幕中间，多次调试| 更改代码结构，得分后设置球为无敌帧状态，不接受碰撞判断，等球复位->拍子复位->倒计时开始，才会取消球的无敌帧状态。|
|本来打算更新一下碰撞逻辑，结果更新以后发现新的碰撞逻辑手感更差了。所以改回老的，结果出BUG了，碰撞只在第一下生效，后续碰撞检测不生效了。查询了以后发现是之前改碰撞逻辑的时候，把碰撞后冷却帧的处理忘掉了。处理之后又有新的问题，就是得分后球的无敌帧更改顺序变了，导致得分后碰撞也不生效。| 更改相关参数 |

---
## 8.许可

---

## 9.日志
| 时间         | 更新                                                                   |
| ---------- | -------------------------------------------------------------------- |
| 2025.10.4 0:45 |看情况CI三线并行想一起通是很困难了，试试单调ubuntu吧|
| 2025.10.4 0:57 |CI的ubuntu支线终于走到package了|
| 2025.10.4 1:19 |CI的ubuntu支线通了|
| 2025.10.4 1:35 |CI的macos支线通了|
| 2025.10.4 1:50 |意图改CI的windows支线，结果现在三个都不通了|
| 2025.10.4 2:44 |CI功能目前通了，完成，洗澡刷牙睡觉|
| 2025.10.5 20:35|天杀的，改了一下SFML的版本依赖，改成3.0以后代码直接不能跑了，主要是构造函数很多都没有给了|
| 2025.10.5 23:11|最基础的状态切换框架完成了，更新了game模块，调试成功|
| 2025.10.5 0:16| 上传以后CI又不通了，好像是依赖库的问题，调了半天，现在windows和ubuntu的通了,macos没通|
| 2025.10.5 0:42| CI通了 |
| 2025.10.5 1:08| 线下实现球拍创建，测试开始游戏、退出游戏、暂停游戏、复位游戏功能 |
| 2025.10.5 1:36| 线下实现球拍移动，左球拍W/S，右球拍↑/↓，添加球拍边界逻辑 |
| 2025.10.5 1:44| 线下实现球的创建 |
| 2025.10.5 2:20| 线下实现球的碰撞逻辑、得分逻辑、反弹角度等等 |
| 2025.10.5 2:40| 解决了横向撞过去球穿模的问题，也解决了为了解决这个问题，而产生的其他问题|
| 2025.10.5 2:55| 上传，线上CI流程完成 |
| 2025.10.6 3:13| 试图更新菜单等界面绘制，本来想着基于imgui绘制，结果为了传入dt又对各个函数模板大改，然后发现imgui强制需要类型sf::windowsevent，而我之前的版本写的都是sf::event，并且windowsevent都是SFML3.0.1版本的事情，我装的是3.0.2，不敢再删库重装了，不然到处都是bug，只能把改掉的代码改回来，然后慢慢重新写|
| 2025.10.6 3:35| 总算修好了，现在能跑了，还增加了状态栏，在玩游戏状态下可以看到一些参数了|
| 2025.10.6 3:51| 球拍形状改了一下，也更改了一些碰撞逻辑|
| 2025.10.6 22:28| 改善了界面显示，添加了button以及其拥有的跳转功能，添加了简单的说明|
| 2025.10.6 23:44| 改善了界面显示，添加了计分板，添加了游戏结束倒计时，以及游戏胜利条件，每次发球前三秒倒计时。|
|  2025.10. 00:01| 试图通过给倒计时加无敌帧的方式，解决球被复位的拍子卡住，导致球无法复位的情况。有所缓解，没法根治|
|  2025.10. 00:20| 更改了复位逻辑，解决了这个问题，现在是球先复位，等开局倒计时结束后，拍子再复位|
|  2025.10. 01:01| 再次更改代码结构，用了更好的方法解决复位bug，现在拍子也可以跟球同时复位，不用等倒计时结束以后才能复位了|
|  2025.10. 01:47| 本来打算更新一下碰撞逻辑，结果更新以后发现新的碰撞逻辑手感更差了。所以改回老的，结果出BUG了，碰撞只在第一下生效，后续碰撞检测不生效了。查询了以后发现是之前改碰撞逻辑的时候，把碰撞后冷却帧的处理忘掉了。处理之后又有新的问题，就是得分后球的无敌帧更改顺序变了，导致得分后碰撞也不生效。更改了相关参数的操作。修复了BUG|